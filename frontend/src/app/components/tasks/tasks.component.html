<!-- Teacher section -->
<section *ngIf="isUserTeacher; else studentSection">
  <div class="text-center">
    <h2>–î–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è</h2>
  </div>

  <ul class="tree">
    <li class="mb-3" *ngFor="let item of homework$ | async">
      <details>
        <summary>{{ item.name }} ({{ item.email }})</summary>
        <ul>
          <li class="mb-2 fs-lg" *ngFor="let homework of item.homework">
            {{ parseTimestamp(homework.date) }} &nbsp;
            <button
              (click)="
                openDialog(
                  item.name,
                  item.email,
                  homework.date,
                  homework.status,
                  homework.content
                )
              "
              class="info-btn"
              type="button"
            >
              <i class="bi bi-info-circle-fill"></i>
            </button>
            <button
              (click)="deleteTask(homework.id)"
              class="info-btn"
              style="margin-left: 15px"
              type="button"
            >
              <i class="bi bi-trash-fill"></i>
            </button>
          </li>
        </ul>
      </details>
    </li>
  </ul>
</section>

<!-- Student section -->
<ng-template #studentSection>
  <section>
    <div class="text-center mb-3">
      <h2>–î–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è</h2>
    </div>

    <div
      *ngIf="(homework$ | async)?.length !== 0; else emptyHomework"
      class="d-flex flex-column align-items-center gap-4"
    >
      <div class="task-card" *ngFor="let item of homework$ | async">
        <h3 style="font-weight: 600">–í–∏–∫–æ–Ω–∞—Ç–∏ –¥–æ</h3>
        <p class="text-center">{{ parseTimestamp(item.date) }}</p>
        <h3 style="font-weight: 600">–°—Ç–∞—Ç—É—Å</h3>
        <p>
          <span *ngIf="item.status === 'not done'; else doneStatus"
            >–ù–µ –≤–∏–∫–æ–Ω–∞–Ω–æ ‚ùå</span
          >
          <ng-template #doneStatus>
            <span>–í–∏–∫–æ–Ω–∞–Ω–æ ‚úÖ</span>
          </ng-template>
        </p>
        <h3 style="font-weight: 600">–ó–∞–≤–¥–∞–Ω–Ω—è</h3>
        <div [innerHTML]="item.content"></div>
        <button
          (click)="changeTaskStatus(item.id, 'done')"
          type="button"
          *ngIf="item.status === 'not done' && !awaitingResponse"
          mat-raised-button
          color="primary"
        >
          –í–∏–∫–æ–Ω–∞–Ω–æ
        </button>
        <button
          (click)="changeTaskStatus(item.id, 'not done')"
          type="button"
          *ngIf="item.status === 'done' && !awaitingResponse"
          mat-raised-button
          color="accent"
        >
          –ù–µ –≤–∏–∫–æ–Ω–∞–Ω–æ
        </button>

        <button
          *ngIf="awaitingResponse"
          type="button"
          mat-raised-button
          disabled
        >
          <div class="spinner-grow spinner-grow-sm" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <span>&nbsp; –ó–∞—á–µ–∫–∞–π—Ç–µ...</span>
        </button>
      </div>
    </div>

    <ng-template #emptyHomework>
      <div class="d-flex align-items-center justify-content-center">
        <h3 class="text-center">–£ –í–∞—Å –ø–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –¥–æ–º–∞—à–Ω—ñ—Ö –∑–∞–≤–¥–∞–Ω—å ü•≥</h3>
      </div>
    </ng-template>
  </section>
</ng-template>
